$.extend({jigsaw:function(b,c,l,f,k,i){if(!f||f<=0){f=3}if(!k||k<=0){k=f*f}if(!l||l<=0){l=window.innerWidth}var g=function(q,p){var o=q.css("left");var u=q.css("top");q.css("left",p.css("left"));q.css("top",p.css("top"));p.css("left",o);p.css("top",u);var s=null;for(var r=0;r<a.length;r++){if(a[r][0]===q[0]||a[r][0]==p[0]){if(s==null){s=r}else{var t=a[s];a[s]=a[r];a[r]=t;break}}}};var n=function(o){var p=$("#cursor1");p.css("left",parseInt(o.css("left"))-1);p.css("top",parseInt(o.css("top"))-1);p.css("display","block")};var m=function(){var o=$("#cursor1");o.css("display","none")};var j=function(){var p=true;for(var o=0;o<a.length;o++){if(a[o].attr("id")!=o){p=false;break}}if(p){for(var o=0;o<a.length;o++){a[o].unbind("click")}if(i&&i!=undefined){i.apply(this,arguments)}$("#tip").html("Congratulation,Your success!")}};var d=$("#"+b);d.css("position","relative");var h=new Image();var a=[];var e=null;h.src=c;$(h).load(function(w){d.css("width",this.width+"px");d.css("height",this.height+"px");var p=this.width/f;var z=this.height/f;var y=l/f;var q=this.height*l/this.width;var u=q/f;for(var B=0;B<f;B++){for(var r=0;r<f;r++){var A=$("<canvas />");A.attr("width",y+1+"px");A.attr("height",u+1+"px");A.css("position","absolute");A.css("left",r*y+"px");A.css("top",B*u+"px");A.attr("id",B*f+r);A.click(function(){var C=$(this);if(e==null){e=C;n(C)}else{if(e[0]==C[0]){e=null;m()}else{g(e,C);e=null;m();j()}}});var x=A[0].getContext("2d");x.drawImage(this,r*p,B*z,p,z,0,0,y+1,u+1);d.append(A);a.push(A)}}for(var v=0;v<k;v++){var t=parseInt(Math.random()*(a.length));var s=parseInt(Math.random()*(a.length));while(t==s){s=parseInt(Math.random()*a.length)}g(a[t],a[s])}var o=$('<div id="cursor1" />');o.css("width",y);o.css("height",u);o.css("display","none");o.css("position","absolute");o.css("border-top","solid 2px #fff");o.css("border-left","solid 2px #fff");o.css("border-right","solid 2px #fff");o.css("border-bottom","solid 2px #fff");o.click(function(){m();e=null});d.append(o)})}});